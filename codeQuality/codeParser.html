<!DOCTYPE html>
<!-- 
START Please preserve this notice
Copyright sohrabsaran@gmail.com, 2020, MIT License.
License file location: https://github.com/sohrabsaran/softwareSkillsDemos/blob/master/LICENSE
Location of this file in its repository: https://github.com/sohrabsaran/softwareSkillsDemos/blob/master/codeQuality/codeParser.html
deployed at: https://sohrabsaran.github.io/softwareSkillsDemos/codeQuality/codeParser.html
END Please preserve this notice

acorn seems to have overtaken esprima
-->
<html>

<head>
<style>
 * {width: 99%;}
</style>
<!-- open source js parser -->
<!-- <script src="https://cdn.jsdelivr.net/npm/esprima/dist/esprima.min.js" crossorigin="anonymous"></script> -->
</head>

<body>
<pre>
Enter html+js or pure js code (change in text content triggers parsing):
<textarea id="ta"  onkeyup="onTaChange()" onpaste="setTimeout(onTaChange,100)">var answer = 42</textarea>

Output:
<div id="outputDiv"></div>
</pre>
<script type="module">
	import * as acorn from 'https://unpkg.com/acorn/dist/acorn.mjs'
	import '../frontend/common.js'
	let outputDiv = el('outputDiv')
	function onTaChange() {
		try {
			let s = elVal('ta'), sArr = [s], files = new Map()
			if(s.includes('/* Content of File ')) {
				sArr = mysplit(s,'/* Content of File ')
				let sArrLen = sArr.length
				for(let i = 0; i < sArrLen; i++) {
					const filePath = leftOf(sArr[i], '*/').trim()
					assert(!files.has(filePath))
					const fileContent = rightOf(sArr[i], '*/')
					files.set(filePath, fileContent)
				}
			}
			let s2 = ''
			for(const s of sArr) {
				let syntax = acorn.parse(elVal('ta'),{locations: true, sourceType: 'module'})
				//let syntax = esprima.parse(elVal('ta'))
				s2 += JSON.stringify(syntax, null, 4) + '\n\n=========\n\n' 
			}
			outputDiv.innerText = s2
		} catch(e){
		   outputDiv.innerText = e.stack
		}
	}
	exportToWindow(onTaChange)
</script>
</body>

</html>

